@page "/register"
@using Blazor.Data
@using Model
@inject IAccountService AccountService
@inject NavigationManager NavigationManager


<EditForm Model="@newAccount" OnValidSubmit="@HandleValidRegister" OnInvalidSubmit="@HandleInvalidRegister">
    <div class="row">
        <div class="col-12">
            <DataAnnotationsValidator/>
            <ValidationSummary/>
            <ul class="orderPageList" data-role="listview">
                <li>
                    <div class="form-group">
                        Username:<br/>
                        <InputText @bind-Value="newAccount.username"/>
                        </div>
                </li>
                <li>
                    <div class="form-group">
                        Password:<br/>
                        <InputText @bind-Value="newAccount.password"/>
                    </div>
                </li>
                <li>
                    <div class="form-group">
                        Email:<br/>
                        <InputText @bind-Value="newAccount.email"/>
                    </div>
                </li>
            </ul>
            <p class="actions">
                <button class="btn btn-danger order-button" type="submit">Register</button>
            </p>
        </div>
    </div>
</EditForm>

@code {

    private string username;
    private string password;
    private string email;
    private string errorMessage;
    
    private Account newAccount = new Account();
    
    
    public async Task HandleValidRegister()
    {
        errorMessage = "";
        try
        {
            Console.WriteLine("Trying register");
            await AccountService.Register(newAccount);
            username = "";
            password = "";
            email = "";
            NavigationManager.NavigateTo("/");
        }
        catch (Exception e)
        {
            Console.WriteLine("Register failed");
            errorMessage = e.Message;
        }
    }
    
    public async Task HandleInvalidRegister()
    {
        Console.WriteLine("Invalid");
    }
    
    protected override async Task OnInitializedAsync()
    {
    }
}